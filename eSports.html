<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>College eSports Tournament Dashboard</title>
<style>
  body {
    background:#0d0d0d;
    color:#e0e0e0;
    font-family:"Poppins",sans-serif;
    padding:20px;
    text-align:center;
  }
  h1{color:#39ff14;text-shadow:0 0 10px #39ff14;}
  button{
    background:#39ff14;
    color:#000;
    border:none;
    padding:10px 20px;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
    margin:10px;
  }
  table{width:100%;border-collapse:collapse;margin-top:20px;}
  th,td{padding:10px;border-bottom:1px solid #222;}
  th{background:#1a1a1a;color:#00ffcc;}
  tr:hover{background:#1f1f1f;}
  input[type=text]{
    background:#111;
    color:#00ffcc;
    border:1px solid #00ffcc;
    border-radius:6px;
    padding:4px 8px;
    width:120px;
    text-align:center;
  }
  .winner{background:#00ffcc;color:#000 !important;}
  .bracket{display:flex;flex-wrap:wrap;justify-content:center;margin-top:30px;}
  .player{
    background:#1a1a1a;
    border:1px solid #00ffcc;
    padding:10px 20px;
    margin:5px;
    border-radius:10px;
    cursor:pointer;
    transition:.3s;
  }
  .player:hover{background:#00ffcc;color:#000;}
  .hidden{display:none;}
  #finalWinner{font-size:1.8em;color:#39ff14;text-shadow:0 0 10px #39ff14;}
</style>
</head>
<body>
<h1>üéÆ College eSports Tournament Dashboard</h1>

<button id="loadBtn">Load Registered Players</button>
<button id="randomBtn" class="hidden">Assign Random Names</button>
<button id="startBtn" class="hidden">Start Tournament</button>

<table id="dataTable" class="hidden">
  <thead>
    <tr>
      <th>Game Name</th>
      <th>Real Name</th>
      <th>Class</th>
      <th>Semester</th>
      <th>Competition</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="rounds" class="hidden">
  <h2>‚öîÔ∏è Stumble Guys ‚Äì Round Selection</h2>
  <p>Select 8 winners who advance to the Fighter Legend Duo finals.</p>
  <div id="roundPlayers" class="bracket"></div>
</div>

<div id="finals" class="hidden">
  <h2>üèÜ Fighter Legend Duo ‚Äì Final Stage (1 v 1)</h2>
  <div id="finalPlayers" class="bracket"></div>
  <div id="finalWinner" class="hidden"></div>
</div>

<script>
const spreadsheetId = '1wPoLkYzRMjpUkOOjn8JFbYzHUx2dB3f539QD7hDcEbg';
const apiKey = 'AIzaSyA4UUq-PYSr4BQlgjy8g9qCax52bjJymA0';
const sheetName = 'Form Responses 1';
const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;

const loadBtn=document.getElementById('loadBtn');
const randomBtn=document.getElementById('randomBtn');
const startBtn=document.getElementById('startBtn');
const table=document.getElementById('dataTable');
const tbody=table.querySelector('tbody');
const rounds=document.getElementById('rounds');
const roundPlayers=document.getElementById('roundPlayers');
const finals=document.getElementById('finals');
const finalPlayers=document.getElementById('finalPlayers');
const finalWinner=document.getElementById('finalWinner');

let players=[];
let finalists=[];

async function loadSheetData(){
  try{
    const response=await fetch(url);
    const result=await response.json();
    const rows=result.values;
    tbody.innerHTML='';
    players=[];
    if(!rows||rows.length<2)return;
    for(let i=1;i<rows.length;i++){
      const row=rows[i];
      const competition=(row[4]||'').toLowerCase();
      if(true){
        const player={name:row[1],class:row[2],sem:row[3],comp:row[4],gameName:''};
        players.push(player);
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td><input type="text" placeholder="Game name" /></td>
          <td>${player.name}</td>
          <td>${player.class}</td>
          <td>${player.sem}</td>
          <td>${player.comp}</td>
        `;
        tbody.appendChild(tr);
      }
    }
    table.classList.remove('hidden');
    randomBtn.classList.remove('hidden');
    startBtn.classList.remove('hidden');
  }catch(err){
    alert("Error loading sheet. Check API key or sharing settings.");
    console.error(err);
  }
}

function assignRandomNames(){
  const nameList=["DarkNinja","BlazeX","FrostByte","NeoStrike","Viper","SkullShot",
  "VenomX","RapidFire","StormRider","RogueWolf","IronBlade","ShadowZ","HexCore","NightFury","CrimsonGhost"];
  const inputs=document.querySelectorAll('#dataTable tbody input');
  inputs.forEach((inp,i)=>{
    const nick=nameList[i%nameList.length]+Math.floor(Math.random()*999);
    inp.value=nick;
    players[i].gameName=nick;
  });
}

function startTournament(){
  // get updated names from inputs
  const inputs=document.querySelectorAll('#dataTable tbody input');
  inputs.forEach((inp,i)=>players[i].gameName=inp.value||players[i].name);

  loadBtn.classList.add('hidden');
  randomBtn.classList.add('hidden');
  startBtn.classList.add('hidden');
  table.classList.add('hidden');
  rounds.classList.remove('hidden');
  renderPlayers(players);
}

function renderPlayers(list){
  roundPlayers.innerHTML='';
  list.forEach(p=>{
    const div=document.createElement('div');
    div.className='player';
    div.innerHTML = `<span class="tag">${p.gameName || p.name}</span> <span class="realname">#${p.name}</span>`;
    div.addEventListener('click',()=>selectWinner(div,p));
    roundPlayers.appendChild(div);
  });
}


function selectWinner(div,player){
  if(div.classList.contains('winner'))return;
  div.classList.add('winner');
  finalists.push(player);
  if(finalists.length===8){
    rounds.classList.add('hidden');
    startFinals();
  }
}

function startFinals(){
  finals.classList.remove('hidden');
  finalPlayers.innerHTML='';
  finalists.forEach(p=>{
    const div=document.createElement('div');
    div.className='player';
    div.innerHTML = `<span class="tag">${p.gameName || p.name}</span> <span class="realname">#${p.name}</span>`;
    div.addEventListener('click',()=>pickChampion(div,p));
    finalPlayers.appendChild(div);
  });
}

function pickChampion(div,p){
  document.querySelectorAll('#finalPlayers .player').forEach(el=>el.classList.remove('winner'));
  div.classList.add('winner');
  finalWinner.textContent=`üèÜ Final Winner: ${p.gameName || p.name}`;
  finalWinner.classList.remove('hidden');
}

loadBtn.addEventListener('click',loadSheetData);
randomBtn.addEventListener('click',assignRandomNames);
startBtn.addEventListener('click',startTournament);
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Location Capture</title>
</head>
<body>

<button id="startBtn">Get My Location</button>
<div id="status">Click the button to start</div>
  
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB97P3HgOUUhTTfDyqZ8_hbp3cQbp3R1Rc",
    authDomain: "chat-a9021.firebaseapp.com",
    databaseURL: "https://chat-a9021-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "chat-a9021",
    storageBucket: "chat-a9021.firebasestorage.app",
    messagingSenderId: "910705138024",
    appId: "1:910705138024:web:8bbf2dd7840b6e28015edd"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const statusEl = document.getElementById("status");
  const btn = document.getElementById("startBtn");

  btn.addEventListener("click", () => {
    btn.disabled = true;
    statusEl.innerText = "Requesting location...";

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const data = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude,
          accuracy: pos.coords.accuracy,
          time: new Date().toISOString(),
          ua: navigator.userAgent
        };

        push(ref(db, "user_locations"), data)
          .then(() => {
            statusEl.innerHTML = `
              ✅ Location saved<br>
              Lat: ${data.lat}<br>
              Lng: ${data.lng}
            `;
          })
          .catch(err => {
            statusEl.innerText = "Firebase write failed ❌";
            console.error(err);
          });
      },
      (err) => {
        statusEl.innerText = "Location permission denied ❌";
        console.error(err.message);
      },
      { enableHighAccuracy: true }
    );
  });
</script>

</body>
</html>

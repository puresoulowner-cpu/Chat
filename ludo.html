<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ludo Game</title>
<style>
  body { font-family: Arial; text-align:center; }
  #dice { width:80px; cursor:pointer; margin:20px auto; }
  #turnStrip {
    background:#222; 
    color:#fff; 
    padding:10px; 
    margin-bottom:20px;
    font-size:20px;
    border-radius:5px;
  }
  #timerBox {
    font-size:22px;
    margin-top:10px;
    color:#e91e63;
  }
</style>
</head>
<body>

<h2>Ludo Game</h2>

<div id="turnStrip">Turn: <span id="turnName">Host</span></div>
<div id="timerBox">Time Left: <span id="timeLeft">30</span>s</div>

<img id="dice" src="https://upload.wikimedia.org/wikipedia/commons/2/2c/Alea_1.png">

<br><br>

<button id="giveScoreBtn">Host → Give Dice Score To Other Player</button>

<!-- Firebase -->
<script type="module">
  // Firebase Import
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBZ1IEOwc72qCs5YS7xsFeJ3mgkml3PEeY",
    authDomain: "sharepe-26c67.firebaseapp.com",
    projectId: "sharepe-26c67",
    storageBucket: "sharepe-26c67.firebasestorage.app",
    messagingSenderId: "127834350155",
    appId: "1:127834350155:web:5ec6f9d5bd30165c47a3ce",
    measurementId: "G-KLV1ZCL9EL",
    databaseURL: "https://sharepe-26c67-default-rtdb.firebaseio.com"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  //------------------------------
  // GAME STATE
  //------------------------------
  let players = ["Host", "Player2", "Player3", "Player4"];
  let turn = 0;  
  let currentDice = 1;
  let timer = 30;
  let timerInterval;

  const diceImg = document.getElementById("dice");
  const turnName = document.getElementById("turnName");
  const timeLeft = document.getElementById("timeLeft");
  const giveScoreBtn = document.getElementById("giveScoreBtn");

  //------------------------------
  // UPDATE TURN STRIP UI
  //------------------------------
  function updateTurnStrip() {
    turnName.innerText = players[turn];
  }

  //------------------------------
  // START 30 SECOND TIMER
  //------------------------------
  function startTimer() {
    clearInterval(timerInterval);
    timer = 30;
    timeLeft.innerText = timer;

    timerInterval = setInterval(() => {
      timer--;
      timeLeft.innerText = timer;
      if (timer <= 0) {
        clearInterval(timerInterval);
        nextTurn();
      }
    }, 1000);
  }

  //------------------------------
  // NEXT TURN
  //------------------------------
  function nextTurn() {
    turn = (turn + 1) % players.length;
    update(ref(db, "game/turn"), turn);
  }

  //------------------------------
  // DICE ROLL
  //------------------------------
  diceImg.onclick = () => {
    if (players[turn] !== "Host") return; // Only Host can roll (or change this logic)

    diceImg.style.transform = "rotate(720deg)";
    const roll = Math.floor(Math.random() * 6) + 1;

    setTimeout(() => {
      diceImg.style.transform = "rotate(0deg)";
      currentDice = roll;

      // Update Firebase
      update(ref(db, "game"), {
        dice: roll
      });
    }, 500);
  };

  //------------------------------
  // HOST → GIVE SCORE TO OTHER PLAYER
  //------------------------------
  giveScoreBtn.onclick = () => {
    if (players[turn] !== "Host") return alert("Only Host can give score!");

    const target = prompt("Give your dice score to which player?\nPlayer2 / Player3 / Player4");
    if (!players.includes(target) || target === "Host") {
      alert("Invalid player name!");
      return;
    }

    update(ref(db, "game"), {
      givenScore: currentDice,
      receiver: target
    });

    alert("Score Sent!");
    nextTurn();
  };

  //------------------------------
  // FIREBASE LISTENERS
  //------------------------------
  onValue(ref(db, "game"), (snap) => {
    if (!snap.exists()) return;

    const data = snap.val();

    // Update Dice Image
    if (data.dice) {
      diceImg.src = `https://upload.wikimedia.org/wikipedia/commons/${dicePath(data.dice)}`;
    }

    // Update Turn
    if (data.turn !== undefined) {
      turn = data.turn;
      updateTurnStrip();
      startTimer();
    }
  });

  //------------------------------
  // RETURN IMAGE PATH
  //------------------------------
  function dicePath(n) {
    return {
      1: "2/2c/Alea_1.png",
      2: "b/b8/Alea_2.png",
      3: "2/2f/Alea_3.png",
      4: "8/8d/Alea_4.png",
      5: "5/55/Alea_5.png",
      6: "f/f4/Alea_6.png"
    }[n];
  }

  //------------------------------
  // INITIALIZE GAME IF EMPTY
  //------------------------------
  onValue(ref(db, "game"), (snap) => {
    if (!snap.exists()) {
      set(ref(db, "game"), {
        turn: 0,
        dice: 1
      });
    }
  });

</script>

</body>
</html>

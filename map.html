<!DOCTYPE html>
<html>
<head>
  <title>Firebase Locations on Map</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    #map {
      height: 450px;
      width: 100%;
      margin-top: 10px;
    }
    #googleMap {
      display: none;
      width: 100%;
      height: 450px;
      border: none;
      margin-top: 10px;
    }
    button {
      margin-right: 10px;
    }
  </style>
</head>
<body>

<h2>Firebase Stored Locations</h2>

<button onclick="showOSM()">üåç OpenStreetMap</button>
<button onclick="showGoogle()">üó∫ Google Maps</button>

<div id="map"></div>
<iframe id="googleMap"></iframe>

<p id="info"></p>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  // üîπ Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyB97P3HgOUUhTTfDyqZ8_hbp3cQbp3R1Rc",
    authDomain: "chat-a9021.firebaseapp.com",
    databaseURL: "https://chat-a9021-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "chat-a9021",
    storageBucket: "chat-a9021.firebasestorage.app",
    messagingSenderId: "910705138024",
    appId: "1:910705138024:web:8bbf2dd7840b6e28015edd"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let map;
  let lastLat = 21.2514;
  let lastLng = 81.6296;

  // üåç Load OpenStreetMap
  function loadOSM(locations) {
    if (map) map.remove();

    map = L.map("map").setView([lastLat, lastLng], 14);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "¬© OpenStreetMap"
    }).addTo(map);

    locations.forEach(loc => {
      L.marker([loc.lat, loc.lng]).addTo(map)
        .bindPopup(`
          <b>Location</b><br>
          Lat: ${loc.lat}<br>
          Lng: ${loc.lng}<br>
          Accuracy: ${loc.accuracy}m
        `);
    });
  }

  // üî• Fetch Firebase data
  get(ref(db, "user_locations")).then(snapshot => {
    if (!snapshot.exists()) {
      document.getElementById("info").innerText = "No data found";
      return;
    }

    const locations = [];
    snapshot.forEach(child => {
      const d = child.val();
      if (d.lat && d.lng) {
        locations.push(d);
        lastLat = d.lat;
        lastLng = d.lng;
      }
    });

    loadOSM(locations);

    // Prepare Google map
    document.getElementById("googleMap").src =
      `https://www.google.com/maps?q=${lastLat},${lastLng}&z=15&output=embed`;

  }).catch(err => {
    console.error(err);
    document.getElementById("info").innerText = "Firebase read error ‚ùå";
  });

  // üîÅ Toggle functions
  window.showOSM = () => {
    document.getElementById("map").style.display = "block";
    document.getElementById("googleMap").style.display = "none";
  };

  window.showGoogle = () => {
    document.getElementById("map").style.display = "none";
    document.getElementById("googleMap").style.display = "block";
  };
</script>

</body>
</html>
